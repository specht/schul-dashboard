#{require_user_who_can_manage_tablets!}
<style>
    /* code {
        color: #000;
    } */
    .rund {
        border-radius: 100%;
        width: 45px;
        height: 45px;
    }
    .eckig {
        width: 45px;
        height: 45px;
    }
    .box {
        width: 45px;
        height: 45px;
    }
</style>
<div class='container-fluid' style='padding-top: 30px; background-color: #000; color: #fff;'>
    <div class='row'>
        <div class="col-md-12">
            <h2 style="margin-bottom: 30px;">Aula Licht</h2>
            <div class="alert alert-warning">
                Die DMX-Kanal Nummern werden noch ergänzt. Bei Fragen oder Problemen, wende dich gerne an Peter-J. Germelmann.<br><br><a class="btn btn-primary" href="mailto:peter-julius.germelmann@mail.gymnasiumsteglitz.de"><i class='fa fa-envelope'></i>&nbsp;&nbsp;E-Mail</a>
            </div>
            <br>
            <!-- <hr>
            Vorne: 24<br>
            Mitte vorne: 8<br>
            Mitte hinten: 4<br>
            Hinten: 4 (LED)<br>
            Seite links: 2 + 1 (LED)<br>
            Seite rechts: 2 + 1 (LED)<br>
            <hr> -->
            <button disabled class='btn btn-outline-secondary eckig box' target='_blank'>L</button>
            <button disabled class='btn btn-outline-secondary eckig box' target='_blank'>R</button>
            &nbsp;&nbsp;Lautsprecher&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class='start btn btn-secondary rund' target='_blank'>00</button>
            &nbsp;&nbsp;LED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class='btn btn-warning eckig' target='_blank'>00</button>
            <button class='btn btn-danger eckig' target='_blank'>00</button>
            &nbsp;&nbsp;
            <button class='btn btn-warning rund' target='_blank'>00</button>
            <button class='btn btn-primary rund' target='_blank'>00</button>
            <button class='btn btn-success rund' target='_blank'>00</button>
            &nbsp;&nbsp;Konventionell&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <div id="last_change" class="pull-right"></div>
            <br><br>
            <div class="table-responsive" style="max-width: 100%; overflow-x: auto;">
                <table class='table table-narrow narrow table-sm table-striped'>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><button id="u" class='btn btn-secondary scheinwerfer rund u' target='_blank'>u</button></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><button id="u" class='btn btn-secondary scheinwerfer rund u' target='_blank'>u</button></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><button id="u" class='btn btn-secondary scheinwerfer rund u' target='_blank'>u</button></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><button id="u" class='btn btn-secondary scheinwerfer rund u' target='_blank'>u</button></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><button id="030" class='btn btn-primary scheinwerfer rund' target='_blank'>11</button></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><button id="029" class='btn btn-primary scheinwerfer rund' target='_blank'>12</button></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><button id="035" class='btn btn-warning scheinwerfer rund' target='_blank'>25</button></td>
                            <td></td>
                            <td></td>
                            <td><button id="031" class='btn btn-warning scheinwerfer eckig' target='_blank'>26</button></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><button id="034" class='btn btn-warning scheinwerfer eckig' target='_blank'>27</button></td>
                            <td></td>
                            <td></td>
                            <td><button id="036" class='btn btn-warning scheinwerfer rund' target='_blank'>28</button></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><button id="u" class='btn btn-secondary scheinwerfer rund u' target='_blank'>u</button></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><button id="u" class='btn btn-secondary scheinwerfer rund u' target='_blank'>u</button></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><button id="024" class='btn btn-warning scheinwerfer eckig' target='_blank'>19</button></td>
                            <td></td>
                            <td></td>
                            <td><button id=" 20" class='btn btn-success scheinwerfer rund' target='_blank'>17</button></td>
                            <td></td>
                            <td></td>
                            <td><button id="023" class='btn btn-warning scheinwerfer eckig' target='_blank'>20</button></td>
                            <td></td>
                            <td></td>
                            <td><button id="028" class='btn btn-warning scheinwerfer eckig' target='_blank'>38</button></td>
                            <td><button id="027" class='btn btn-warning scheinwerfer eckig' target='_blank'>38</button></td>
                            <td></td>
                            <td></td>
                            <td><button id="021" class='btn btn-warning scheinwerfer eckig' target='_blank'>21</button></td>
                            <td></td>
                            <td></td>
                            <td><button id="022" class='btn btn-success scheinwerfer rund' target='_blank'>18</button></td>
                            <td></td>
                            <td></td>
                            <td><button id="019" class='btn btn-warning scheinwerfer eckig' target='_blank'>22</button></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><button id="041" class='btn btn-warning scheinwerfer rund' target='_blank'>29</button></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><button id="boxL" disabled class='btn btn-outline-secondary eckig box' target='_blank'>L</button></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><button id="boxR" disabled class='btn btn-outline-secondary eckig box' target='_blank'>R</button></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><button id="048" class='btn btn-warning scheinwerfer rund' target='_blank'>30</button></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                            <td><button id="042" class='btn btn-warning scheinwerfer eckig' target='_blank'>31</button></td>
                            <td><button id="038" class='btn btn-warning scheinwerfer eckig' target='_blank'>32</button></td>
                            <td><button id="039" class='btn btn-primary scheinwerfer rund' target='_blank'>7</button></td>
                            <td><button id="040" class='btn btn-warning scheinwerfer rund' target='_blank'>33</button></td>
                            <td><button id="006" class='btn btn-warning scheinwerfer rund' target='_blank'>1</button></td>
                            <td><button id="013" class='btn btn-danger scheinwerfer eckig' target='_blank'>13</button></td>        
                            <td><button id="004" class='btn btn-warning scheinwerfer rund' target='_blank'>2</button></td>                       
                            <td><button id="003" class='btn btn-danger scheinwerfer eckig' target='_blank'>14</button></td>
                            <td><button id="002" class='btn btn-primary scheinwerfer rund' target='_blank'>8</button></td>
                            <td><button id="001" class='btn btn-warning scheinwerfer rund' target='_blank'>3</button></td>
                            <td><button id="016" class='btn btn-warning scheinwerfer rund' target='_blank'>23</button></td>
                            <td><button id="017" class='btn btn-warning scheinwerfer rund' target='_blank'>37</button></td>
                            <td><button id="015" class='btn btn-warning scheinwerfer rund' target='_blank'>24</button></td>
                            <td><button id="018" class='btn btn-warning scheinwerfer rund' target='_blank'>23</button></td>
                            <td><button id="008" class='btn btn-warning scheinwerfer rund' target='_blank'>4</button></td>
                            <td><button id="007" class='btn btn-primary scheinwerfer rund' target='_blank'>9</button></td>
                            <td><button id="009" class='btn btn-danger scheinwerfer eckig' target='_blank'>15</button></td>
                            <td><button id="010" class='btn btn-warning scheinwerfer rund' target='_blank'>5</button></td>
                            <td><button id="011" class='btn btn-danger scheinwerfer eckig' target='_blank'>16</button></td>
                            <td><button id="012" class='btn btn-warning scheinwerfer rund' target='_blank'>6</button></td>
                            <td><button id="046" class='btn btn-warning scheinwerfer rund' target='_blank'>34</button></td>
                            <td><button id="047" class='btn btn-primary scheinwerfer rund' target='_blank'>10</button></td>
                            <td><button id="045" class='btn btn-warning scheinwerfer eckig' target='_blank'>35</button></td>
                            <td><button id="044" class='btn btn-warning scheinwerfer eckig' target='_blank'>36</button></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        </div>
    </div>
</div>
<script>
    function refresh_aula_light() {
        $('.u').html('⚠️')
        api_call('/api/get_light', function(data) {
            for (let entry of data.light) {
                $('#' + entry.lightdata.dmx).html('Test')
            }
        });
    } 


document.addEventListener('DOMContentLoaded', function () {
    refresh_aula_light();
    $('.scheinwerfer').click(function (e) {
        var dmx = e.target.id;
        var desk = e.target.innerHTML
        api_call('/api/get_light_data', {dmx: dmx}, function(data) {
            let entry = data.light
            showTemplateModal('Channel <b><code>"' + entry.lightdata.desk + '"</code></b>',
            'Dieser Scheinwerfer liegt auf dem DMX-Kanal <b><code>' + dmx + '</code></b>.<br><br><input type="number" id="al_desk_channel" class="form-control" placeholder="Channel auf dem Lichtpult" value="' + desk + '"></input>',
            "<i class='fa fa-check'></i>&nbsp;&nbsp;Speichern", 'btn-success',
            'Abbrechen', 'btn-secondary', function() {
                let input_desk = $('#al_desk_channel').val();
                api_call('/api/set_desk_number', {dmx: dmx, desk: input_desk}, function(data) {
                    if (data.success)
                        refresh_aula_light();
                });
            })
            
    });
        });
    });
    // $('#write_dmx_channels').click(function (e) {
    //     // for (let i of )
    // });
</script>
